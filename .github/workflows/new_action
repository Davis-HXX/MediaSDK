name: ubuntu-20.04

on: [ push, pull_request ]

jobs:
  cleanup:
    runs-on: [self-hosted, linux, medium]
    container:
      image: dockerv2-gfx-build.gfx-assets.intel.com/common/ubuntu20.04:23
    steps:
      - name: Cleaning up the $GITHUB_WORKSPACE as root from a Docker image
        # Volume auto mounted by gh actions pointing to the current working-directory
        run: find /__w/${{ github.event.repository.name }}/${{ github.event.repository.name }}/. -name . -o -prune -exec rm -rf -- {} + || true
  default-gcc:
    runs-on: [self-hosted, linux, medium]
    needs: cleanup
    steps:
    - name: checkout libmfxgen
      uses: actions/checkout@v2
      with:
        path: libmfxgen
        clean: false
    - name: checkout libva
      uses: actions/checkout@v2
      with:
        repository: intel/libva
        path: libva
        clean: false
    - name: build
      uses: ./libmfxgen/.github/actions
      id: build
      with:
        build-flavor: Release 
